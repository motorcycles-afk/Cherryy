<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Status - Cherry Executor</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white">
    <div id="particles-js"></div>

    <!-- Navigation -->
    <nav class="fixed top-0 left-0 right-0 z-50 glass">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="/" class="text-xl font-bold gradient-text">Cherry Executor</a>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/user-dashboard.html" class="px-4 py-2 bg-purple-500 hover:bg-purple-600 rounded text-white transition">
                        <i class="fas fa-user mr-2"></i>User Dashboard
                    </a>
                    <a href="/admin-dashboard.html" id="adminPanel" class="hidden px-4 py-2 bg-purple-500 hover:bg-purple-600 rounded text-white transition">
                        <i class="fas fa-shield-alt mr-2"></i>Admin Panel
                    </a>
                    <button id="logoutBtn" class="hover:text-red-500 transition">
                        <i class="fas fa-sign-out-alt mr-2"></i>Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto pt-24 px-4">
        <!-- System Status -->
        <div class="glass p-8 mb-8">
            <h1 class="text-4xl font-bold gradient-text mb-4">System Status</h1>
            <p id="systemStatus" class="text-gray-400"></p>
        </div>

        <!-- Important Information -->
        <div class="glass p-8 mb-8">
            <h2 class="text-3xl font-bold gradient-text mb-4">Important Information</h2>
            <div id="importantInfo" class="space-y-4">
                <!-- Important information will be populated here -->
            </div>
        </div>

        <!-- Notices -->
        <div class="glass p-8 mb-8">
            <h2 class="text-3xl font-bold gradient-text mb-4">Notices</h2>
            <div id="noticesContainer" class="space-y-4">
                <!-- Notices will be populated here -->
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script>
        // Initialize particles.js
        particlesJS('particles-js', {
            particles: {
                number: { value: 80 },
                color: { value: '#ffffff' },
                opacity: { value: 0.5 },
                size: { value: 3 },
                line_linked: {
                    enable: true,
                    distance: 150,
                    color: '#ffffff',
                    opacity: 0.4,
                    width: 1
                },
                move: {
                    enable: true,
                    speed: 6
                }
            }
        });

        // Fetch and display system status and notices
        document.addEventListener('DOMContentLoaded', async () => {
            const token = localStorage.getItem('token');
            const user = JSON.parse(localStorage.getItem('user'));
            console.log('Token:', token);
            console.log('User:', user);
            if (!token) {
                window.location.href = '/login.html';
            }
            // Display admin panel button if user is admin
            if (user && user.role === 'admin') {
                console.log('User is admin, showing admin panel button');
                document.getElementById('adminPanel').classList.remove('hidden');
            } else {
                console.log('User is not admin, hiding admin panel button');
            }

            try {
                const statusResponse = await fetch('https://getcherry.vercel.app/api/admin/get-status', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                const statusData = await statusResponse.json();
                if (statusData.success) {
                    const systemStatus = document.getElementById('systemStatus');
                    systemStatus.textContent = statusData.status.message;
                    const importantInfo = document.getElementById('importantInfo');
                    importantInfo.textContent = statusData.status.importantInfo;
                } else {
                    console.error('Failed to fetch system status:', statusData.error);
                }
            } catch (error) {
                console.error('Error fetching system status:', error);
            }

            try {
                const noticesResponse = await fetch('https://getcherry.vercel.app/api/admin/get-notices', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                const noticesData = await noticesResponse.json();
                if (noticesData.success) {
                    const noticesContainer = document.getElementById('noticesContainer');
                    noticesContainer.innerHTML = '';
                    if (noticesData.notices.length === 0) {
                        noticesContainer.textContent = 'There are currently no notices set.';
                    } else {
                        noticesData.notices.forEach(notice => {
                            const noticeElement = document.createElement('div');
                            noticeElement.className = `p-4 rounded ${notice.type === 'info' ? 'bg-blue-500' : notice.type === 'warning' ? 'bg-yellow-500' : 'bg-red-500'}`;
                            noticeElement.textContent = notice.text;
                            noticesContainer.appendChild(noticeElement);
                        });
                    }
                } else {
                    console.error('Failed to fetch notices:', noticesData.error);
                }
            } catch (error) {
                console.error('Error fetching notices:', error);
            }
        });
    </script>
</body>
</html>
